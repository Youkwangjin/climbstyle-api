<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
    <title>ClimbStyle</title>
    <link rel="stylesheet" th:href="@{/css/common/common.css}">
    <link rel="stylesheet" th:href="@{/css/auth/auth.css}">
</head>
<body>
<header>
    <div th:replace="~{fragments/common/header:: header}"></div>
</header>

<main class="auth-section">
    <div class="container auth-wrap">
        <section class="auth-card" aria-labelledby="login-title">
            <h1 id="login-title">로그인</h1>
            <p class="auth-sub">클라이밍 패션 피드와 쇼핑을 한 번에, ClimbStyle에 로그인하세요.</p>

            <form class="auth-form">
                <div class="field">
                    <label for="userId">아이디</label>
                    <input id="userId"
                           type="text"
                           placeholder="아이디를 입력하세요"
                           required />
                </div>

                <div class="field">
                    <label for="userPassword">비밀번호</label>
                    <input id="userPassword"
                           type="password"
                           placeholder="비밀번호를 입력하세요"
                           required />
                </div>

                <div class="field field-row">
                    <a class="link-muted" th:href="@{/auth/forgot/password}">비밀번호 찾기</a>
                </div>

                <div class="field">
                    <button class="btn btn-primary auth-submit" type="button" onclick="login()">로그인</button>
                </div>

                <p class="auth-footer">아직 계정이 없나요?<a th:href="@{/auth/register}">회원가입</a></p>
            </form>
        </section>
    </div>
</main>
<div th:replace="~{fragments/common/footer :: footer}"></div>
<script th:src="@{/js/common/api.js}"></script>
<script th:src="@{/js/common/validator.js}"></script>
<script>
    function login() {
        if (!Validator.login()) {
            return;
        }

        API.callJson("/api/v1/login", {
            method: "POST",
            body: JSON.stringify({
                userId: document.getElementById("userId").value.trim(),
                userPassword: document.getElementById("userPassword").value.trim()
            })
        })
            .then(async response => {
                const body = await response.json();
                if (!response.ok) {
                    alert(body.message);
                    return;
                }

                window.location.href = body.data.redirectUrl;
            })
            .catch(() => {
                alert("일시적인 문제가 발생했습니다. 지속될 경우 관리자한테 문의하세요.")
            })
    }
</script>
</body>
</html>
